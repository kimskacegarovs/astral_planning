<ul class="border border-gray-500 rounded" id="location-search-result-container">
    {% for result in search_results %}
        <form id="location-search-result-{{ forloop.counter }}"
              hx-trigger="click"
              hx-post="{% url "location_search_result_select" %}"
              hx-target="#location-form-container"
              hx-swap="outerHTML"
              hx-vals="js:{data: getMergedFormsData(['location-search-result-{{ forloop.counter }}', 'location-form'])}">
            {% csrf_token %}
            <li class="{% cycle 'bg-gray-700' 'bg-gray-800' %} hover:bg-gray-500 transition-colors duration-300 cursor-pointer">
                {{ result.display_name }}
            </li>
            <input type="hidden" name="result" value="{{ result.as_json }}">
        </form>
    {% endfor %}
</ul>

<script>
    function getMergedFormsData(formIds) {
        const result = {};
        for (const formId of formIds) {
            const form = document.getElementById(formId);
            const formData = new FormData(form);
            for (const [key, value] of formData.entries()) result[key] = value;
        }
        return result;
    }

    document.addEventListener('click', function (event) {
        const searchResults = document.getElementById('location-search-result-container');
        if (!searchResults.contains(event.target)) {
            searchResults.style.display = 'none';
        }
    });
</script>
